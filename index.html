let token = '';  // Store the JWT token

async function generateToken() {
    const response = await fetch('/generate-token', { method: 'POST' });
    const data = await response.json();
    token = data.token;
}

// Sending the JWT with the pedido
async function enviarPedido() {
    await generateToken();

    const prato = document.getElementById('prato').value;
    const acompanhamento = document.getElementById('acompanhamento').value;
    const bebida = document.getElementById('bebida').value;
    const preco = document.getElementById('preco').value;

    await fetch('/pedidos', {
        method: 'POST',
        headers: {
            'Authorization': `Bearer ${token}`,
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({ prato, acompanhamento, bebida, preco })
    }).then(response => {
        if (response.ok) {
            alert("Pedido enviado com sucesso!");
            document.getElementById('pedidoForm').reset();
        } else {
            alert("Erro ao enviar pedido.");
        }
    });
}

// Function to list pedidos
async function listarPedidos() {
    await generateToken();

    const response = await fetch('/pedidos', {
        method: 'GET',
        headers: {
            'Authorization': `Bearer ${token}`
        }
    });

    const pedidos = await response.json();
    const listaPedidos = document.getElementById('lista-pedidos');

    pedidos.forEach(pedido => {
        const item = document.createElement('li');
        item.textContent = `${pedido.prato} - ${pedido.acompanhamento} - R$${pedido.preco}`;

        listaPedidos.appendChild(item);
    });
}
